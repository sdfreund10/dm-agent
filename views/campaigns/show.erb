<% c = @campaign %>
<% @title = c.name %>
<div class="page-header">
  <div class="prompt"><%= h(c.name) %></div>
  <form action="/campaigns/<%= c.id %>" method="post" class="delete-form" data-turbo-confirm="Delete this campaign?">
    <input type="hidden" name="_method" value="delete">
    <button type="submit" class="btn btn-icon" title="Delete campaign" aria-label="Delete campaign"><svg class="icon-trash" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg></button>
  </form>
</div>

<div class="divider">—</div>
<div class="section-title">Genre &amp; mood</div>
<p class="character-meta"><%= h(c.genre) %> · <%= h(c.tone) %></p>
<div class="divider">—</div>

<% if c.hook && !c.hook.to_s.strip.empty? %>
  <div class="section-title">Hook</div>
  <div class="markdown-prose"><%= markdown(c.hook) %></div>
  <div class="divider">—</div>
<% end %>

<div class="section-title">Playthroughs</div>
<% playthroughs = c.campaign_chats %>
<% if playthroughs.empty? %>
  <p class="character-meta">No playthroughs yet.</p>
<% else %>
  <ul class="character-list">
    <% playthroughs.each do |chat| %>
      <li>
        <span>
          <span class="character-name"><%= chat.player_character ? h(chat.player_character.name) : h(chat.player_character_id) %></span>
          <span class="character-meta"> — Last message <%= chat.last_message_at ? time_ago_in_words(chat.last_message_at) + " ago" : "—" %></span>
        </span>
        <a href="/playthroughs/<%= chat.id %>" class="btn">View</a>
      </li>
    <% end %>
  </ul>
<% end %>
<a href="/campaigns/<%= c.id %>/playthroughs/new" class="btn-outline-sm" style="margin-top: 0.5rem;">Start new playthrough</a>

<div class="divider">—</div>
<a href="/" class="block-link">&larr; Back to home</a>
